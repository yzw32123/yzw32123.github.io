"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},initUtils={getCookie:function(key){var strCookie=document.cookie;strCookie||navigator.cookieEnabled&&window.localStorage&&window.localStorage.getItem("wechatCookies")&&(strCookie=window.localStorage.getItem("wechatCookies"));for(var arrCookie=strCookie.split("; "),i=0;i<arrCookie.length;i++){var arr=arrCookie[i].split("=");if(arr[0]==key)return arr[1]}return""},m7HandleLocal:function(str){if(navigator.cookieEnabled&&window.localStorage){var old=window.localStorage.getItem("wechatCookies")||"",strArr=str.split("; ")||[],newStr="";strArr.forEach(function(item){old.indexOf(item)<=-1&&(newStr+=item+"; ")}),window.localStorage.setItem("wechatCookies",old+newStr)}},setCookie:function(obj,value,exp,domain){var cookieTime=864e5;exp&&"session"!=exp&&(cookieTime*=exp);var d=new Date;d.setTime(d.getTime()+cookieTime);var cookieExpires="; expires="+d.toGMTString(),domainStr="";if(domain&&null!=domain&&(domainStr="; domain="+domain),"string"==typeof obj){var str=obj+"="+encodeURIComponent(value)+"; ";document.cookie=obj+"="+encodeURIComponent(value)+("session"==exp?"":cookieExpires)+domainStr+"; path=/",initUtils.m7HandleLocal(str)}else{str=obj+"="+encodeURIComponent(value)+"; ";for(var key in obj)document.cookie=key+"="+encodeURIComponent(obj[key])+("session"==exp?"":cookieExpires)+domainStr+"; path=/";initUtils.m7HandleLocal(str)}},generateUUID:function(){var d=(new Date).getTime();return window.performance&&"function"==typeof window.performance.now&&(d+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=(d+16*Math.random())%16|0;return d=Math.floor(d/16),("x"==c?r:3&r|8).toString(16)})}};window.console=window.console||function(){var c={};return c.log=c.warn=c.debug=c.info=c.error=c.time=c.dir=c.profile=c.clear=c.exception=c.trace=c.assert=function(){},c}(),String.prototype.m7trim=function(){return void 0===this?"":this.replace(/^\s*/g,"").replace(/\s*$/g,"")};var hostUrl="/",moor7Source="";if(document.currentScript)hostUrl=(moor7Source=document.currentScript.src).split("javascripts")[0];else for(var m7script=document.getElementsByTagName("script"),i=0;i<=m7script.length;i++){var m7scriptSrc=m7script[i].src;if(-1<m7scriptSrc.indexOf("javascripts/7moorInit.js")){hostUrl=moor7Source=m7scriptSrc.split("javascripts")[0];break}}!function(){var ie=!(!window.attachEvent||window.opera),wk=/webkit\/(\d+)/i.test(navigator.userAgent)&&RegExp.$1<525,fn=[],run=function(){for(var i=0;i<fn.length;i++)fn[i]()},d=document;d.ready=function(f){if(!ie&&!wk&&d.addEventListener)return d.addEventListener("DOMContentLoaded",f,!1);if(!(1<fn.push(f)))if(ie)!function(){try{d.documentElement.doScroll("left"),run()}catch(err){setTimeout(arguments.callee,0)}}();else if(wk)var t=setInterval(function(){/^(loaded|complete)$/.test(d.readyState)&&(clearInterval(t),run())},0)}}();var clientId="",otherParams="";"string"==typeof qimoClientId&&"undefined"!=qimoClientId&&(clientId=encodeURIComponent(qimoClientId)),"object"==("undefined"==typeof qimoClientId?"undefined":_typeof(qimoClientId))&&(clientId=qimoClientId.userId||"");var phoneSystemFrom="",m7navigator=navigator.userAgent,isAndroidFlag=-1<m7navigator.indexOf("Android")||-1<m7navigator.indexOf("Linux"),isIOSFlag=!!m7navigator.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/);isAndroidFlag&&(phoneSystemFrom="android"),isIOSFlag&&(phoneSystemFrom="ios");var qimo_config={chatHost:hostUrl,accessId:0,language:"zh-CN",autoShow:!0,m7webchatpage:!1,version:"1.0",chatPage:hostUrl+"view/moor_chat.html",companyConfigUrl:hostUrl+"online",urlTitle:encodeURIComponent(document.title),fromUrl:encodeURIComponent(window.location.href),clientId:clientId,location:window.location.host,otherParams:otherParams,M7CardInfo:{},referrer:document.referrer||"",videoPage:"https://rtc.7moor.com/",screenSharePage:"https://rtc.7moor.com:9443",userBehaviorVideoId:"",ubaOnOff:"false",sessionLastToPeer:"",proxyMsgUrl:"",uvpvSwitch:"false",sessionInvitation:"0",phoneSystemFrom:phoneSystemFrom,newMsgNotPop:!1,hasInitConfig:!1,reInitCallback:void 0,refreshUnreopen:!1,parseQuerystring:function(queryStr){if("string"!=typeof queryStr)return{};if(""===(queryStr=queryStr.m7trim()))return{};var json={};try{for(var pairs=queryStr.split("&"),i=0;i<pairs.length;i++){var kv=pairs[i].split("=");kv[0]&&kv[1]&&(json[kv[0]]=decodeURIComponent(kv[1]))}}catch(e){}return json},hideImgUpload:!1,hideFileUpload:!1,videoDownloadBtn:!1},href=window.location.href,headSimplifyFlag=!1;if(0<href.indexOf("?")){var query_arr=href.split("?")[1].split("&");try{for(var p=0;p<query_arr.length;p++){var temp=query_arr[p].split("=");"headSimplify"==temp[0]&&"true"===temp[1]&&(headSimplifyFlag=!0)}}catch(e){}}var simplifyFlag=headSimplifyFlag||"object"==("undefined"==typeof qimoClientId?"undefined":_typeof(qimoClientId))&&qimoClientId.headSimplify;simplifyFlag&&phoneSystemFrom&&(qimo_config.chatPage=qimo_config.chatPage.replace("moor_chat.html","moor_chat_simplify.html")),"object"==("undefined"==typeof qimoClientId?"undefined":_typeof(qimoClientId))&&qimoClientId.refreshUnreopen&&(qimo_config.refreshUnreopen=qimoClientId.refreshUnreopen);var onlineData=void 0,lastReferrer=qimo_config.referrer,firstSeoRefer=initUtils.getCookie("qimo_firstSeoRefer"),seoUrl="",seoSource="",seoKeywords="",skey="qimo_seosource_"+qimo_config.accessId,kkey="qimo_seokeywords_"+qimo_config.accessId;!function(){if(""!==(seoUrl=firstSeoRefer?decodeURIComponent(firstSeoRefer):lastReferrer)){var host="",temps=initUtils.getCookie(skey),tempk=initUtils.getCookie(kkey);if(seoUrl&&(host=seoUrl.split("/")[2]),host==window.location.host)seoSource=temps?decodeURIComponent(temps):"站内",seoKeywords=tempk?decodeURIComponent(tempk):"";else if("www.baidu.com"==host){if(seoSource="百度搜索",0<seoUrl.indexOf("?"))seoUrl.split("?")[1].split("&").forEach(function(query){var temp=query.split("=");"wd"!=temp[0]&&"word"!=temp[0]||(seoKeywords=temp[1])})}else if("m.baidu.com"==host){if(seoSource="百度搜索",0<seoUrl.indexOf("?"))seoUrl.split("?")[1].split("&").forEach(function(query){var temp=query.split("=");"word"==temp[0]&&(seoKeywords=temp[1])})}else if("www.so.com"==host){if(seoSource="360搜索",0<seoUrl.indexOf("?"))seoUrl.split("?")[1].split("&").forEach(function(query){var temp=query.split("=");"q"==temp[0]&&(seoKeywords=temp[1])})}else if("m.so.com"==host){if(seoSource="360搜索",0<seoUrl.indexOf("?"))seoUrl.split("?")[1].split("&").forEach(function(query){var temp=query.split("=");"q"==temp[0]&&(seoKeywords=temp[1])})}else if("www.sogou.com"==host){if(seoSource="搜狗搜索",0<seoUrl.indexOf("?"))seoUrl.split("?")[1].split("&").forEach(function(query){var temp=query.split("=");"query"==temp[0]&&(seoKeywords=temp[1])})}else if("wap.sogou.com"==host){if(seoSource="搜狗搜索",0<seoUrl.indexOf("?"))seoUrl.split("?")[1].split("&").forEach(function(query){var temp=query.split("=");"keyword"==temp[0]&&(seoKeywords=temp[1])})}else if("so.m.sm.cn"==host){if(seoSource="神马搜索",0<seoUrl.indexOf("?"))seoUrl.split("?")[1].split("&").forEach(function(query){var temp=query.split("=");"keyword"==temp[0]&&(seoKeywords=temp[1])})}else seoSource="其他网站",seoKeywords="未知"}else seoSource="站内",seoKeywords="";seoSource||seoKeywords?(initUtils.setCookie(skey,seoSource,1/48),initUtils.setCookie(kkey,seoKeywords,1/48)):(initUtils.setCookie(skey,seoSource,-1),initUtils.setCookie(kkey,seoKeywords,-1))}(),function(){var scripts={localInit:"7moorInit.js",pcChat:qimo_config.chatHost+"javascripts/QiMoIMSDK-d2f4405f61.js",externalAPI:qimo_config.chatHost+"javascripts/external_api.js",ubaJs:"https://user-analysis.7moor.com/js/uba.min.js",recorderJs:qimo_config.chatHost+"javascripts/recorder.js",mobileBackJs:qimo_config.chatHost+"javascripts/mobileBackFunc.js"},Configure={init:function(){var cookieSid=Configure.getCookie("parent_qimo_sid_"+qimo_config.accessId)||"";cookieSid||initUtils.getCookie("uuid_"+qimo_config.accessId)||initUtils.setCookie("uuid_"+qimo_config.accessId,initUtils.generateUUID());var uuid=initUtils.getCookie("uuid_"+qimo_config.accessId)||"",cookieSidOruuid=cookieSid||uuid;cookieSidOruuid=cookieSidOruuid?cookieSidOruuid.trim():"";var data={accessId:qimo_config.accessId,unionAccessId:qimo_config.unionAccessId,location:encodeURIComponent(window.location.host),referrer:document.referrer||"",callbackF:"getChatConfig",action:"getOnlineStates",sid:cookieSidOruuid,seoSource:seoSource,fromUrl:qimo_config.fromUrl,hideImgUpload:qimo_config.hideImgUpload,hideFileUpload:qimo_config.hideFileUpload};this.loadJsonp(qimo_config.companyConfigUrl,data)},getCookie:function(key){var strCookie=document.cookie;strCookie||navigator.cookieEnabled&&window.localStorage&&window.localStorage.getItem("wechatCookies")&&(strCookie=window.localStorage.getItem("wechatCookies"));for(var arrCookie=strCookie.split("; "),i=0;i<arrCookie.length;i++){var arr=arrCookie[i].split("=");if(arr[0]==key)return arr[1]}return""},getInitJsData:function(){for(var src,s=document.getElementsByTagName("script"),i=0,n=s.length;i<n;i++)if((src=s[i].src)&&-1<src.indexOf(scripts.localInit)){src=src.toLowerCase();break}if(src&&0<src.indexOf("accessid=")){var querys=qimo_config.parseQuerystring(src.substr(src.indexOf("?")+1));if(qimo_config.accessId=querys.accessid,qimo_config.language="en"===querys.language?"en":"zh-CN",querys.fromurl&&(qimo_config.fromUrl=querys.fromurl),querys.autoshow&&(qimo_config.autoShow=querys.autoshow),"true"===querys.m7webchatpage&&(qimo_config.m7webchatpage=!0),querys.wap&&(qimo_config.wap=querys.wap),querys.newmsgnotpop&&(qimo_config.newMsgNotPop=querys.newmsgnotpop),querys.unionaccessid&&(qimo_config.unionAccessId=querys.unionaccessid),querys.hideimgupload&&(qimo_config.hideImgUpload=querys.hideimgupload),querys.hidefileupload&&(qimo_config.hideFileUpload=querys.hidefileupload),querys.accessaftermessage&&"true"===querys.accessaftermessage&&(qimo_config.accessAfterMessage=!0),querys.accessaftermessage&&"false"===querys.accessaftermessage&&(qimo_config.accessAfterMessage=!1),querys.customcolor){/^#(?:[0-9a-f]{3}){1,2}$/i.test(querys.customcolor)&&(qimo_config.customColor=querys.customcolor.replace("#",""))}querys.videoDownloadBtn&&"true"===querys.videoDownloadBtn&&(qimo_config.videoDownloadBtn=!0)}scripts.pcChat=scripts.pcChat+"?accessId="+qimo_config.accessId},addJsElement:function(src){var el=document.createElement("script");el.setAttribute("charset","UTF-8"),el.src=src;var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(el,s)},loadJsonp:function(url,data){var query=function(json){json=json||{};var query_arr=[];for(var key in json.__=(new Date).getTime(),json){var val=json[key];"fromUrl"!==key?query_arr.push(key+"="+encodeURIComponent(val)):query_arr.push(key+"="+val)}return query_arr.join("&").replace(/%20/g,"+")}(data),script=document.createElement("script");script.type="text/javascript",script.setAttribute("charset","UTF-8"),script.src=url+"?"+query;try{document.body.appendChild(script)}catch(e){document.ready(function(){document.body.appendChild(script)})}},loadUbaJs:function(){var paneNode=document.getElementById("qimo_chatpup");paneNode&&paneNode.getElementsByTagName("iframe")[0].contentWindow.postMessage("ubaInfo_"+JSON.stringify({}),"*")},loadVedioJs:function(url){var script=document.createElement("script");script.type="text/javascript",script.setAttribute("charset","UTF-8"),script.src=url;try{document.body.appendChild(script)}catch(e){document.ready(function(){document.body.appendChild(script)})}}};Configure.getInitJsData(),Configure.init(),window.getChatConfig=function(c){onlineData=c,void 0!==qimo_config.unionAccessId&&void 0!==c.accessId&&(qimo_config.accessId=c.accessId),"true"!==c.ubaOnOff?qimo_config.ubaOnOff="false":qimo_config.ubaOnOff=c.ubaOnOff,"true"!==c.uvpvSwitch?qimo_config.uvpvSwitch="false":qimo_config.uvpvSwitch=c.uvpvSwitch,"1"!==c.sessionInvitation?qimo_config.sessionInvitation="0":qimo_config.sessionInvitation=c.sessionInvitation,qimo_config.version=c.version,qimo_config.companyName=c.companyName,qimo_config.account=c.account,c.isSessionExist?qimo_config.sessionLastToPeer=c.sessionToPeer:qimo_config.sessionLastToPeer="",onlineData.pageTitle&&qimo_config.m7webchatpage&&(document.title=onlineData.pageTitle),!0===onlineData.backJsEnable&&Configure.addJsElement(scripts.mobileBackJs),!0!==qimo_config.hasInitConfig?(Configure.addJsElement(scripts.pcChat+"&v="+qimo_config.version),qimo_config.hasInitConfig=!0):window.qimosdk.reInitChat(onlineData,function(){console.log("切换完成")})},window.m7InitConfigure=Configure}();